<UserControl x:Class="ETAG_ERP.Views.SalesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Background="#f5f6fa">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="250"/>
            <!-- التصنيفات -->
            <ColumnDefinition Width="*"/>
            <!-- محتوى الأصناف والجدول -->
        </Grid.ColumnDefinitions>

        <!-- يمكن وضع شيء في عمود التصنيفات لو حابب -->
        <Border Grid.Column="0" Background="#e0e0e0" Margin="5" CornerRadius="5">
            <TextBlock Text="تصنيفات (اختياري)" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="Gray"/>
        </Border>

        <!-- محتوى الأصناف والجدول -->
        <Grid Grid.Column="1" Margin="5" Background="Transparent">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <!-- أزرار -->
                <RowDefinition Height="350"/>
                <!-- ScrollViewer للكروت -->
                <RowDefinition Height="*"/>
                <!-- DataGrid -->
                <RowDefinition Height="Auto"/>
                <!-- شريط الإجمالي -->
            </Grid.RowDefinitions>

            <!-- أزرار أعلى الشاشة -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,0,0,5" >
                <ComboBox Width="180" Margin="5,0" SelectedItem="{Binding SelectedDocumentType}">
                    <ComboBoxItem Content="فاتورة"/>
                    <ComboBoxItem Content="عرض سعر"/>
                    <ComboBoxItem Content="إذن استلام"/>
                    <ComboBoxItem Content="أمر توريد"/>
                </ComboBox>
                <Button Content="💾 حفظ" Width="80" Margin="5,0" Command="{Binding SaveCommand}"/>
                <Button Content="🖨 طباعة" Width="80" Margin="5,0" Command="{Binding PrintCommand}"/>
                <Button Content="📤 تصدير" Width="80" Margin="5,0" Command="{Binding ExportCommand}"/>
            </StackPanel>

            <!-- كروت الأصناف -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" >
                <ItemsControl ItemsSource="{Binding Items}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" IsItemsHost="True"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="White" BorderBrush="#ddd" BorderThickness="1" CornerRadius="8" Width="160" Height="200" Margin="5" Padding="5" >
                                <StackPanel>
                                    <Image Source="{Binding ImagePath}" Height="80" Stretch="UniformToFill"/>
                                    <TextBlock Text="{Binding Name}" TextWrapping="Wrap" FontWeight="Bold" Margin="0,5,0,0" FontSize="14"/>
                                    <TextBlock Text="{Binding Price1, StringFormat='السعر 1: {0:C}'}" Foreground="DarkGreen" FontSize="12"/>
                                    <TextBlock Text="{Binding Price2, StringFormat='السعر 2: {0:C}'}" Foreground="DarkBlue" FontSize="12"/>
                                    <TextBlock Text="{Binding Price3, StringFormat='السعر 3: {0:C}'}" Foreground="DarkOrange" FontSize="12"/>
                                    <TextBlock Text="{Binding PurchasePrice, StringFormat='س. شراء: {0:C}'}" Foreground="Gray" FontSize="12"/>

                                    <Button Content="➕" Margin="0,5,0,0" Command="{Binding DataContext.AddItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                            CommandParameter="{Binding}" Background="#27ae60" Foreground="White"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- جدول الأصناف المختارة -->
            <DataGrid Grid.Row="2" ItemsSource="{Binding SelectedItems}" AutoGenerateColumns="False" Margin="0,5,0,0"
                      HorizontalAlignment="Stretch" VerticalAlignment="Stretch" SelectionChanged="DataGrid_SelectionChanged">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="الكود" Binding="{Binding Code}" Width="100"/>
                    <DataGridTextColumn Header="الاسم" Binding="{Binding Name}" Width="200"/>
                    <DataGridTextColumn Header="الكمية" Binding="{Binding Quantity}" Width="80"/>
                    <DataGridTextColumn Header="السعر" Binding="{Binding Price}" Width="100"/>
                    <DataGridTextColumn Header="السعر 1" Binding="{Binding Price}" Width="100"/>
                    <DataGridTextColumn Header="2 السعر" Binding="{Binding Price}" Width="100"/>
                    <DataGridTextColumn Header="الإجمالي" Binding="{Binding Total}" Width="100"/>
                    <DataGridTemplateColumn Header="حذف" Width="60">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="❌" Command="{Binding DataContext.RemoveItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                        CommandParameter="{Binding}" Background="Red" Foreground="White"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <!-- شريط الإجمالي -->
            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,5,0,0">
                <TextBlock Text="الإجمالي: " FontWeight="Bold" FontSize="14"/>
                <TextBlock Text="{Binding TotalAmount, StringFormat={}{0:C}}" Foreground="DarkGreen" FontWeight="Bold" FontSize="14"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
