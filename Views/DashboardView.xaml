<UserControl x:Class="ETAG_ERP.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="#F7F7F7"
             FontFamily="Segoe UI"
             FlowDirection="RightToLeft"
             Height="800" Width="1200">

    <!-- موارد محلية: ستايلات بسيطة وآمنة -->
    <UserControl.Resources>
        <!-- ظل بسيط للكروت -->
        <DropShadowEffect x:Key="SoftShadow" BlurRadius="12" ShadowDepth="2" Opacity="0.25"/>

        <!-- بطاقة KPI -->
        <Style x:Key="KpiCard" TargetType="Border">
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Margin" Value="6"/>
            <Setter Property="Padding" Value="14"/>
            <Setter Property="Effect" Value="{StaticResource SoftShadow}"/>
        </Style>

        <!-- عنوان داخل البطاقة -->
        <Style x:Key="KpiTitle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Opacity" Value="0.95"/>
        </Style>

        <!-- الرقم داخل البطاقة -->
        <Style x:Key="KpiNumber" TargetType="TextBlock">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="22"/>
        </Style>

        <!-- كارت صغير للملخصات -->
        <Style x:Key="MiniCard" TargetType="Border" BasedOn="{StaticResource KpiCard}">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E6E6E6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12"/>
        </Style>

        <!-- رؤوس GroupBox -->
        <Style TargetType="GroupBox">
            <Setter Property="Margin" Value="6"/>
            <Setter Property="Padding" Value="8"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- العنوان + الفلاتر -->
            <RowDefinition Height="Auto"/>
            <!-- بطاقات KPI -->
            <RowDefinition Height="Auto"/>
            <!-- توزيع أنواع العمليات -->
            <RowDefinition Height="*"/>
            <!-- جداول وتحليلات -->
        </Grid.RowDefinitions>

        <!-- العنوان + شريط فلاتر بسيط (بدون Events) -->
        <DockPanel Grid.Row="0" LastChildFill="True" Margin="0,0,0,16">
            <TextBlock Text="📊 لوحة التقارير الرئيسية"
                       FontSize="26" FontWeight="Bold" Foreground="#2C3E50"
                       VerticalAlignment="Center" Margin="0,0,12,0"/>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                <TextBlock Text="من:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <DatePicker x:Name="FromDatePicker" Width="140" Margin="0,0,10,0"/>
                <TextBlock Text="إلى:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <DatePicker x:Name="ToDatePicker" Width="140" Margin="0,0,10,0"/>
                <ComboBox x:Name="DocTypeFilter" Width="160" Margin="0,0,10,0" SelectedIndex="0">
                    <ComboBoxItem Content="كل الأنواع"/>
                    <ComboBoxItem Content="صفقات"/>
                    <ComboBoxItem Content="مناقصات"/>
                    <ComboBoxItem Content="توريدات"/>
                    <ComboBoxItem Content="بيع نقدي"/>
                    <ComboBoxItem Content="بيع آجل"/>
                    <ComboBoxItem Content="صيانة/أوامر شغل"/>
                </ComboBox>
                <ComboBox x:Name="StatusFilter" Width="140" SelectedIndex="0">
                    <ComboBoxItem Content="كل الحالات"/>
                    <ComboBoxItem Content="جاري"/>
                    <ComboBoxItem Content="منتهي"/>
                    <ComboBoxItem Content="متأخر"/>
                    <ComboBoxItem Content="ملغي"/>
                </ComboBox>
            </StackPanel>
        </DockPanel>

        <!-- بطاقات KPI رئيسية -->
        <UniformGrid Grid.Row="1" Columns="5" Margin="0,0,0,14">
            <Border Style="{StaticResource KpiCard}" Background="#4CAF50" ToolTip="عدد العقود والصفقات الجارية">
                <StackPanel>
                    <TextBlock Text="إجمالي العقود الجارية" Style="{StaticResource KpiTitle}"/>
                    <TextBlock x:Name="TotalContractsValue" Text="—" Style="{StaticResource KpiNumber}"/>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource KpiCard}" Background="#2196F3" ToolTip="قيمة المناقصات الفائزة">
                <StackPanel>
                    <TextBlock Text="المناقصات الفائزة (قيمة)" Style="{StaticResource KpiTitle}"/>
                    <TextBlock x:Name="WonTendersValue" Text="—" Style="{StaticResource KpiNumber}"/>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource KpiCard}" Background="#FF9800" ToolTip="إجمالي المبيعات (نقدي + آجل)">
                <StackPanel>
                    <TextBlock Text="إجمالي المبيعات" Style="{StaticResource KpiTitle}"/>
                    <TextBlock x:Name="TotalSalesValue" Text="—" Style="{StaticResource KpiNumber}"/>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource KpiCard}" Background="#9C27B0" ToolTip="إجمالي المصروفات بنفس المدى">
                <StackPanel>
                    <TextBlock Text="إجمالي المصروفات" Style="{StaticResource KpiTitle}"/>
                    <TextBlock x:Name="TotalExpensesValue" Text="—" Style="{StaticResource KpiNumber}"/>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource KpiCard}" Background="#2C3E50" ToolTip="صافي الربح = المبيعات - المصروفات">
                <StackPanel>
                    <TextBlock Text="صافي الأرباح" Style="{StaticResource KpiTitle}"/>
                    <TextBlock x:Name="NetProfitValue" Text="—" Style="{StaticResource KpiNumber}"/>
                </StackPanel>
            </Border>
        </UniformGrid>

        <!-- توزيع العمليات حسب النوع (كروت صغيرة) -->
        <ScrollViewer Grid.Row="2" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Disabled">
            <UniformGrid Columns="5">
                <Border Style="{StaticResource MiniCard}">
                    <StackPanel>
                        <TextBlock Text="صفقات" Foreground="#2C3E50" FontWeight="SemiBold"/>
                        <TextBlock x:Name="DealsCount" Text="0 عملية" Margin="0,4,0,0"/>
                        <TextBlock x:Name="DealsValue" Text="0.00 ج" FontWeight="Bold" Foreground="#2C3E50"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource MiniCard}">
                    <StackPanel>
                        <TextBlock Text="مناقصات" Foreground="#2C3E50" FontWeight="SemiBold"/>
                        <TextBlock x:Name="TendersCount" Text="0 عملية" Margin="0,4,0,0"/>
                        <TextBlock x:Name="TendersValue" Text="0.00 ج" FontWeight="Bold" Foreground="#2C3E50"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource MiniCard}">
                    <StackPanel>
                        <TextBlock Text="توريدات" Foreground="#2C3E50" FontWeight="SemiBold"/>
                        <TextBlock x:Name="SuppliesCount" Text="0 عملية" Margin="0,4,0,0"/>
                        <TextBlock x:Name="SuppliesValue" Text="0.00 ج" FontWeight="Bold" Foreground="#2C3E50"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource MiniCard}">
                    <StackPanel>
                        <TextBlock Text="بيع نقدي" Foreground="#2C3E50" FontWeight="SemiBold"/>
                        <TextBlock x:Name="CashSalesCount" Text="0 فاتورة" Margin="0,4,0,0"/>
                        <TextBlock x:Name="CashSalesValue" Text="0.00 ج" FontWeight="Bold" Foreground="#2C3E50"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource MiniCard}">
                    <StackPanel>
                        <TextBlock Text="بيع آجل" Foreground="#2C3E50" FontWeight="SemiBold"/>
                        <TextBlock x:Name="CreditSalesCount" Text="0 فاتورة" Margin="0,4,0,0"/>
                        <TextBlock x:Name="CreditSalesValue" Text="0.00 ج" FontWeight="Bold" Foreground="#2C3E50"/>
                    </StackPanel>
                </Border>
            </UniformGrid>
        </ScrollViewer>

        <!-- جداول وتحليلات -->
        <Grid Grid.Row="3">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- ملخص الذمم -->
            <UniformGrid Rows="1" Columns="4" Margin="0,10,0,8">
                <Border Style="{StaticResource MiniCard}">
                    <StackPanel>
                        <TextBlock Text="ذمم مدينة (عملاء)" Foreground="#2C3E50" FontWeight="SemiBold"/>
                        <TextBlock x:Name="ReceivablesValue" Text="0.00 ج" FontWeight="Bold" Margin="0,4,0,0"/>
                        <TextBlock x:Name="OverdueReceivablesCount" Text="متأخر: 0" Foreground="#C0392B"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource MiniCard}">
                    <StackPanel>
                        <TextBlock Text="ذمم دائنة (موردين)" Foreground="#2C3E50" FontWeight="SemiBold"/>
                        <TextBlock x:Name="PayablesValue" Text="0.00 ج" FontWeight="Bold" Margin="0,4,0,0"/>
                        <TextBlock x:Name="OverduePayablesCount" Text="متأخر: 0" Foreground="#C0392B"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource MiniCard}">
                    <StackPanel>
                        <TextBlock Text="أوامر صيانة مفتوحة" Foreground="#2C3E50" FontWeight="SemiBold"/>
                        <TextBlock x:Name="OpenServiceOrders" Text="0 أمر" FontWeight="Bold" Margin="0,4,0,0"/>
                        <TextBlock x:Name="ServiceDueSoon" Text="مستحق قريبًا: 0" Foreground="#E67E22"/>
                    </StackPanel>
                </Border>
                <Border Style="{StaticResource MiniCard}">
                    <StackPanel>
                        <TextBlock Text="مخزون حرج" Foreground="#2C3E50" FontWeight="SemiBold"/>
                        <TextBlock x:Name="CriticalStockItems" Text="0 صنف" FontWeight="Bold" Margin="0,4,0,0"/>
                        <TextBlock Text="أقل من الحد الأدنى" Foreground="#7F8C8D"/>
                    </StackPanel>
                </Border>
            </UniformGrid>

            <!-- 3 جداول: الصفقات/العقود، أفضل العملاء، أفضل الموردين -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- أعلى العقود/الصفقات -->
                <GroupBox Header="🏆 أعلى العقود/الصفقات حسب القيمة" Grid.Column="0" Margin="6">
                    <DataGrid x:Name="TopDealsGrid" AutoGenerateColumns="False" CanUserAddRows="False"
                              IsReadOnly="True" HeadersVisibility="Column" Height="260"
                              GridLinesVisibility="None" AlternatingRowBackground="#FFF7F7F7">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="العقد/الصفقة" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="العميل" Binding="{Binding Client}" Width="180"/>
                            <DataGridTextColumn Header="الحالة" Binding="{Binding Status}" Width="110"/>
                            <DataGridTextColumn Header="القيمة" Binding="{Binding Amount}" Width="140"/>
                            <DataGridTextColumn Header="تاريخ التسليم" Binding="{Binding DueDate}" Width="140"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>

                <!-- أفضل العملاء -->
                <GroupBox Header="👤 أفضل العملاء" Grid.Column="1" Margin="6">
                    <DataGrid x:Name="TopClientsGrid" AutoGenerateColumns="False" CanUserAddRows="False"
                              IsReadOnly="True" HeadersVisibility="Column" Height="260"
                              GridLinesVisibility="None" AlternatingRowBackground="#FFF7F7F7">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="العميل" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="إجمالي التعامل" Binding="{Binding Total}" Width="160"/>
                            <DataGridTextColumn Header="آخر تاريخ" Binding="{Binding LastDate}" Width="140"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>

                <!-- أفضل الموردين -->
                <GroupBox Header="🤝 أفضل الموردين" Grid.Column="2" Margin="6">
                    <DataGrid x:Name="TopSuppliersGrid" AutoGenerateColumns="False" CanUserAddRows="False"
                              IsReadOnly="True" HeadersVisibility="Column" Height="260"
                              GridLinesVisibility="None" AlternatingRowBackground="#FFF7F7F7">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="المورد" Binding="{Binding Name}" Width="*"/>
                            <DataGridTextColumn Header="إجمالي التوريدات" Binding="{Binding Total}" Width="160"/>
                            <DataGridTextColumn Header="آخر توريد" Binding="{Binding LastDate}" Width="140"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
