<Window x:Class="ETAG_ERP.Views.SettingsView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="الإعدادات"
        Height="800" Width="1300"
        FlowDirection="RightToLeft" 
        FontFamily="Segoe UI"
        WindowStartupLocation="CenterScreen"
        Background="#f5f6fa">

    <Grid Margin="10" Background="#f5f6fa">

        <!-- TabControl عصري مع ألوان متدرجة -->
        <TabControl FontSize="14" Background="White" BorderThickness="0" 
                    Margin="0" Padding="0">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Padding" Value="15,8"/>
                    <Setter Property="Margin" Value="2"/>
                    <Setter Property="Background" Value="#3498db"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                    <Setter Property="BorderBrush" Value="#2980b9"/>
                    <Setter Property="BorderThickness" Value="1"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border Name="Bd" Background="{TemplateBinding Background}" 
                                        BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" 
                                        CornerRadius="5,5,0,0" Padding="{TemplateBinding Padding}">
                                    <ContentPresenter x:Name="Content" ContentSource="Header" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter TargetName="Bd" Property="Background" Value="#2c3e50"/>
                                        <Setter Property="Foreground" Value="White"/>
                                    </Trigger>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="Bd" Property="Background" Value="#2980b9"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.Resources>

            <!-- 1️⃣ الإعدادات العامة -->
            <TabItem Header="🏢 الإعدادات العامة">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20" Width="650">

                        <GroupBox Header="قاعدة البيانات" FontWeight="Bold" Margin="0,0,0,20">
                            <StackPanel Margin="10">
                                <Button Content="🔄 إعادة إنشاء قاعدة البيانات" Height="40" Width="300"
                                        Click="ResetDatabase_Click" Background="#e74c3c" Foreground="White" Margin="0,0,0,10"/>
                                <TextBlock Text="مسار قاعدة البيانات:" Margin="0,10,0,5" Foreground="Black"/>
                                <TextBox x:Name="txtDatabasePath" IsReadOnly="True" Height="30" TextChanged="txtDatabasePath_TextChanged"/>
                                <Button Content="📂 تغيير المسار" Width="300" Height="35" Click="ChangeDatabasePath_Click" Margin="0,10,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="بيانات الشركة والفروع" FontWeight="Bold">
                            <StackPanel Margin="10">
                                <TextBlock Text="اسم الشركة:" Foreground="Black"/>
                                <TextBox x:Name="txtCompanyName" Height="30" TextChanged="txtCompanyName_TextChanged"/>
                                <TextBlock Text="العنوان:" Margin="0,10,0,0" Foreground="Black"/>
                                <TextBox x:Name="txtCompanyAddress" Height="30" TextChanged="txtCompanyAddress_TextChanged"/>
                                <TextBlock Text="الهاتف:" Margin="0,10,0,0" Foreground="Black"/>
                                <TextBox x:Name="txtCompanyPhone" Height="30" TextChanged="txtCompanyPhone_TextChanged"/>
                                <TextBlock Text="البريد الإلكتروني:" Margin="0,10,0,0" Foreground="Black"/>
                                <TextBox x:Name="txtCompanyEmail" Height="30" TextChanged="txtCompanyEmail_TextChanged"/>

                                <TextBlock Text="الفروع / المخازن / الورش:" FontWeight="Bold" Margin="0,10,0,5"/>
                                <DataGrid x:Name="BranchesDataGrid" AutoGenerateColumns="False" CanUserAddRows="False" Height="150" SelectionChanged="BranchesDataGrid_SelectionChanged">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="الاسم" Binding="{Binding Name}" Width="*"/>
                                        <DataGridTextColumn Header="النوع" Binding="{Binding Type}" Width="*"/>
                                        <DataGridTextColumn Header="الموقع" Binding="{Binding Location}" Width="*"/>
                                        <DataGridCheckBoxColumn Header="نشط" Binding="{Binding IsActive}" Width="80"/>
                                        <DataGridTemplateColumn Header="تحكم" Width="150">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <Button Content="🖉" Click="EditBranch_Click" Width="50" Margin="2"/>
                                                        <Button Content="🗑" Click="DeleteBranch_Click" Width="50" Margin="2"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                                <Button Content="➕ إضافة فرع / مخزن / ورشة" Width="250" Height="35" Click="AddBranch_Click" Margin="0,10,0,0"/>
                                <Button Content="💾 حفظ الإعدادات" Width="250" Height="35" Background="#27ae60" Foreground="White" Margin="0,10,0,0" Click="SaveGeneralSettings_Click"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            <!-- 2️⃣ المستخدمون والموظفون -->
            <TabItem Header="المستخدمون والموظفون">
                <Grid Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="450"/>
                    </Grid.ColumnDefinitions>

                    <!-- Users -->
                    <GroupBox Header="المستخدمون" FontWeight="Bold" Grid.Column="0" Margin="0,0,10,0">
                        <StackPanel Margin="10">
                            <DataGrid x:Name="UsersDataGrid" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" Height="350" SelectionChanged="UsersDataGrid_SelectionChanged">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="اسم المستخدم" Binding="{Binding Username}" Width="*"/>
                                    <DataGridTextColumn Header="الاسم الكامل" Binding="{Binding FullName}" Width="*"/>
                                    <DataGridTextColumn Header="الدور" Binding="{Binding Role}" Width="*"/>
                                    <DataGridTemplateColumn Header="تحكم" Width="120">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <Button Content="🖉" Click="EditUser_Click" Width="50" Margin="2"/>
                                                    <Button Content="🗑" Click="DeleteUser_Click" Width="50" Margin="2"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                            <Button Content="إضافة مستخدم" Width="150" Height="35" Click="AddUser_Click" Margin="0,10,0,0"/>
                        </StackPanel>
                    </GroupBox>

                    <!-- Employees -->
                    <GroupBox Header="الموظفون / المندوبون" FontWeight="Bold" Grid.Column="1">
                        <StackPanel Margin="10">
                            <DataGrid x:Name="EmployeesDataGrid" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" Height="350" SelectionChanged="EmployeesDataGrid_SelectionChanged">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="الاسم" Binding="{Binding Name}" Width="*"/>
                                    <DataGridTextColumn Header="الوظيفة" Binding="{Binding Job}" Width="*"/>
                                    <DataGridTextColumn Header="الهاتف" Binding="{Binding Phone}" Width="*"/>
                                    <DataGridTemplateColumn Header="تحكم" Width="120">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal">
                                                    <Button Content="🖉" Click="EditEmployee_Click" Width="50" Margin="2"/>
                                                    <Button Content="🗑" Click="DeleteEmployee_Click" Width="50" Margin="2"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                            <Button Content="إضافة موظف / مندوب" Width="150" Height="35" Click="AddEmployee_Click" Margin="0,10,0,0"/>
                        </StackPanel>
                    </GroupBox>
                </Grid>
            </TabItem>

            <!-- 3️⃣ صلاحيات المستخدمين -->
            <TabItem Header="صلاحيات المستخدمين">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="15" Width="Auto">
                        <!-- اختيار المستخدم -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="اختر المستخدم:" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,10,0"/>
                            <ComboBox x:Name="cmbUsersPermissions" Width="250" Margin="0,0,10,0" SelectionChanged="cmbUsersPermissions_SelectionChanged"/>
                            <Button Content="تحميل الصلاحيات" Width="150" Height="35" Background="#2196F3" Foreground="White" Click="LoadPermissions_Click"/>
                        </StackPanel>

                        <!-- الصلاحيات -->
                        <GroupBox Header="قائمة الصلاحيات" FontWeight="Bold" Margin="0,0,0,10">
                            <TreeView x:Name="PermissionsTreeView" Margin="5" />
                        </GroupBox>

                        <!-- أزرار التحكم -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,10,0,0">
                            <Button Content="تحديد الكل" Width="120" Height="35" Margin="0,0,10,0" Click="SelectAllPermissions_Click" Background="#FFC107" Foreground="Black"/>
                            <Button Content="إلغاء التحديد" Width="150" Height="35" Margin="0,0,10,0" Click="UnselectAllPermissions_Click" Background="#FF5722" Foreground="White"/>
                            <Button Content="حفظ الصلاحيات" Width="150" Height="35" Click="SavePermissions_Click" Background="#4CAF50" Foreground="White"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            <!-- 4️⃣ الوسائط والطباعة والتصدير -->
            <TabItem Header="الوسائط والطباعة والتصدير">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="15" Width="Auto">

                        <!-- 📷 الصور -->
                        <GroupBox Header="الصور والخلفيات" FontWeight="Bold" FontSize="14" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <Button Content="رفع صورة خلفية عامة" Width="250" Height="35" 
                            Click="UploadBackgroundImage_Click" Margin="0,0,0,10"/>
                                <Image x:Name="BackgroundImage" Visibility="Collapsed" Height="150" Stretch="Uniform" Margin="0,0,0,10"/>
                                <Button Content="رفع صور المنتجات" Width="250" Height="35" 
                            Click="UploadProductImages_Click"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- 📂 استيراد وتصدير -->
                        <GroupBox Header="استيراد / تصدير البيانات" FontWeight="Bold" FontSize="14" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <Button Content="استيراد بيانات العملاء" Width="250" Height="35" 
                            Click="ImportClients_Click" Margin="0,0,0,10"/>
                                <Button Content="استيراد بيانات الأصناف" Width="250" Height="35" 
                            Click="ImportItems_Click" Margin="0,0,0,10"/>
                                <Button Content="تصدير جميع البيانات" Width="250" Height="35" 
                            Click="ExportAllData_Click"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- 🖨️ الطباعة -->
                        <GroupBox Header="إدارة الطباعة والنماذج" FontWeight="Bold" FontSize="14">
                            <StackPanel Margin="10">
                                <Button Content="رفع نموذج طباعة جديد" Width="250" Height="35" 
                            Click="UploadPrintTemplate_Click" Margin="0,0,0,10"/>
                                <Button Content="اختيار الطابعة الافتراضية" Width="250" Height="35" 
                            Click="ChooseDefaultPrinter_Click" Margin="0,0,0,10"/>
                                <Button Content="معاينة الطباعة" Width="250" Height="35" 
                            Click="PreviewPrint_Click"/>
                            </StackPanel>
                        </GroupBox>

                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 📂 إدارة التصنيفات (Explorer Style) -->
            <TabItem Header="إدارة التصنيفات">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <!-- Toolbar -->
                        <RowDefinition Height="*"/>
                        <!-- Main Content -->
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="250"/>
                        <!-- Tree -->
                        <ColumnDefinition Width="323*"/>
                        <ColumnDefinition Width="182*"/>
                        <!-- Items -->
                    </Grid.ColumnDefinitions>

                    <!-- 🔧 Toolbar -->
                    <ToolBar Grid.Row="0" Grid.ColumnSpan="3" Background="#f5f5f5" Padding="5" Margin="0,0,0,659" Grid.RowSpan="2">
                        <Button Content="➕ جديد" Click="AddCategory_Click" Margin="3"/>
                        <Button Content="✏ تعديل" Click="EditCategory_Click" Margin="3"/>
                        <Button Content="🗑 حذف" Click="DeleteCategory_Click" Margin="3"/>
                        <Button Content="🔄 تحديث" Click="RefreshCategories_Click" Margin="3"/>
                    </ToolBar>

                    <!-- 📂 TreeView (التصنيفات) -->
                    <TreeView x:Name="CategoryTreeView" Grid.Row="1" Grid.Column="0" Margin="0,5,10,0"
                  SelectedItemChanged="CategoryTreeView_SelectedItemChanged">
                        <TreeView.Resources>
                            <ContextMenu x:Key="CategoryContextMenu">
                                <MenuItem Header="➕ إضافة فرع" Click="AddSubCategory_Click"/>
                                <MenuItem Header="✏ تعديل" Click="EditCategory_Click"/>
                                <MenuItem Header="🗑 حذف" Click="DeleteCategory_Click"/>
                            </ContextMenu>
                            <Style TargetType="TreeViewItem">
                                <Setter Property="ContextMenu" Value="{StaticResource CategoryContextMenu}"/>
                            </Style>
                        </TreeView.Resources>
                    </TreeView>

                    <!-- 📋 DataGrid (الأصناف التابعة للتصنيف) -->
                    <DockPanel Grid.Row="1" Grid.Column="1" Grid.ColumnSpan="2">
                        <StackPanel>
                            <TextBlock Text="الأصناف التابعة للتصنيف المحدد" 
                           FontWeight="Bold" FontSize="14" Margin="0,0,0,10"/>

                            <DataGrid x:Name="ItemsDataGrid" AutoGenerateColumns="False" CanUserAddRows="False" 
                          IsReadOnly="True" Height="400" SelectionChanged="ItemsDataGrid_SelectionChanged">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="الكود" Binding="{Binding ItemCode}" Width="120"/>
                                    <DataGridTextColumn Header="اسم الصنف" Binding="{Binding ItemName}" Width="*"/>
                                    <DataGridTextColumn Header="السعر" Binding="{Binding Price}" Width="120"/>
                                    <DataGridTextColumn Header="الكمية" Binding="{Binding Quantity}" Width="100"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </DockPanel>
                </Grid>
            </TabItem>

            <!-- 6️⃣ إعدادات المحاسبة / الخزنة -->
            <TabItem Header="إعدادات الحسابات والخزنة">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <TextBlock Text="إعدادات الحسابات والخزنة" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                            <Button Content="إضافة حساب / خزنة" Width="200" Height="35" Click="AddAccount_Click" Margin="5"/>
                            <Button Content="تعديل" Width="100" Height="35" Click="EditAccount_Click" Margin="5"/>
                            <Button Content="حذف" Width="100" Height="35" Click="DeleteAccount_Click" Margin="5"/>
                        </StackPanel>
                        <DataGrid x:Name="AccountsDataGrid" AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True" Height="300" SelectionChanged="AccountsDataGrid_SelectionChanged">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="اسم الحساب" Binding="{Binding Name}" Width="*"/>
                                <DataGridTextColumn Header="النوع" Binding="{Binding Type}" Width="*"/>
                                <DataGridTextColumn Header="الرصيد الابتدائي" Binding="{Binding OpeningBalance}" Width="*"/>
                                <DataGridTextColumn Header="الوصف" Binding="{Binding Description}" Width="*"/>
                            </DataGrid.Columns>
                        </DataGrid>
                        <Button Content="حفظ إعدادات الحسابات والخزنة" Width="250" Height="35" Background="#4CAF50" Foreground="White" Margin="0,10,0,0" Click="SaveAccountsSettings_Click"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>


        </TabControl>
    </Grid>
</Window>
